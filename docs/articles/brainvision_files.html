<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manipulating a clean EEG file exported from BrainVision 2.0 • eeguana</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Manipulating a clean EEG file exported from BrainVision 2.0">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eeguana</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/brainvision_files.html">Manipulating a clean EEG file exported from BrainVision 2.0</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bnicenboim/eeguana">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Manipulating a clean EEG file exported from BrainVision 2.0</h1>
                        <h4 class="author">Bruno Nicenboim</h4>
            
            <h4 class="date">2018-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bnicenboim/eeguana/blob/master/vignettes/brainvision_files.Rmd"><code>vignettes/brainvision_files.Rmd</code></a></small>
      <div class="hidden name"><code>brainvision_files.Rmd</code></div>

    </div>

    
    
<p><em>eeguana</em> provides a framework for manipulating EEG data with <em>dplyr</em>-based function (e.g., <code>mutate</code>, <code>filter</code>, <code>summarize</code>) extended to a new class <code>eeg_lst</code>. In addition, it provides other EEG-specialized functions, and <code>ggplot</code> wrapper functions. The new class is inspired by tidyverse principles but it’s not really “tidy” (due to space considerations), it’s a list of (i) a wide table (<code>signal_tbl</code>) that contains the signal amplitudes at every sample point of the EEG, (ii) an events table with information about markers (or triggers), blinks and other exported information, and (iii) a long table with experimental information, such as participant (<code>recording</code>), conditions, etc.</p>
<p>Here, I exemplify the use of <em>eeguana</em> with (pre-processed) EEG data from BrainVision 2.0. The data belong to a simple experiment where a participant was presented 100 faces and 100 assorted images in random order. The task of the experiment was to mentally count the number of faces.</p>
<p>First we download the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">download.file</span>(<span class="st">"https://www.ling.uni-potsdam.de/~nicenboim/files/faces.vhdr"</span>, 
              <span class="st">"faces.vhdr"</span>, <span class="dt">mode=</span><span class="st">"wb"</span>)
<span class="kw">download.file</span>(<span class="st">"https://www.ling.uni-potsdam.de/~nicenboim/files/faces.vmrk"</span>, 
              <span class="st">"faces.vmrk"</span>, <span class="dt">mode=</span><span class="st">"wb"</span>)
<span class="kw">download.file</span>(<span class="st">"https://www.ling.uni-potsdam.de/~nicenboim/files/faces.dat"</span>, 
              <span class="st">"faces.dat"</span>, <span class="dt">mode=</span><span class="st">"wb"</span>)</code></pre></div>
<p>BrainVision 2.0 exports three files: <code>faces.vhdr</code>, <code>faces.vmrk</code>, and <code>faces.dat</code>. The file <code>faces.vhdr</code> contains the metadata and links to the other two files, <code>faces.vmrk</code> contains the triggers and other events in the samples, and <code>faces.dat</code> contains the signals at every sample for every channel recorded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(eeguana)</code></pre></div>
<p>We first need to read the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/read_vhdr">read_vhdr</a></span>(<span class="st">"faces.vhdr"</span>)
<span class="co">#&gt; # Data from faces.dat was read.</span>
<span class="co">#&gt; # Data from 1 segment(s) and 34 channels was loaded.</span>
<span class="co">#&gt; # Object size in memory 147 MB</span></code></pre></div>
<p>The function <code>read_vhdr</code> creates a list with data frames for the signal, events, segments information, and incorporates in its attributes generic EEG information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces
<span class="co">#&gt; $signal</span>
<span class="co">#&gt; # A tibble: 525,207 x 36</span>
<span class="co">#&gt;      .id .sample_id   Fp1      Fpz    Fp2    F7     F3     Fz    F4     F8</span>
<span class="co">#&gt;    &lt;int&gt;      &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1          1 -4.27 -12.5    -8.51   5.81  0.799 -3.79  -7.00  -9.59</span>
<span class="co">#&gt;  2     1          2 -5.99 -11.3    -8.30   4.47 -0.456 -3.92  -7.31 -10.2 </span>
<span class="co">#&gt;  3     1          3 -6.58  -9.33   -7.68   3.71 -1.84  -3.69  -7.33 -10.6 </span>
<span class="co">#&gt;  4     1          4 -5.90  -6.18   -6.08   3.95 -2.63  -2.27  -6.54 -10.5 </span>
<span class="co">#&gt;  5     1          5 -5.35  -2.58   -3.96   4.62 -2.96  -0.172 -5.45 -10.3 </span>
<span class="co">#&gt;  6     1          6 -6.19   0.246  -2.29   4.85 -3.32   1.66  -4.58 -10.3 </span>
<span class="co">#&gt;  7     1          7 -7.80   1.79   -1.50   4.27 -3.77   2.81  -4.03 -10.6 </span>
<span class="co">#&gt;  8     1          8 -8.61   2.21   -1.18   3.49 -4.31   3.15  -3.71 -10.6 </span>
<span class="co">#&gt;  9     1          9 -7.93   1.64   -0.730  3.28 -4.79   2.71  -3.40  -9.60</span>
<span class="co">#&gt; 10     1         10 -6.56  -0.0265 -0.457  3.81 -4.92   1.63  -3.23  -7.73</span>
<span class="co">#&gt; # ... with 525,197 more rows, and 26 more variables: FC5 &lt;dbl&gt;, FC1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   FC2 &lt;dbl&gt;, FC6 &lt;dbl&gt;, M1 &lt;dbl&gt;, T7 &lt;dbl&gt;, C3 &lt;dbl&gt;, Cz &lt;dbl&gt;,</span>
<span class="co">#&gt; #   C4 &lt;dbl&gt;, T8 &lt;dbl&gt;, M2 &lt;dbl&gt;, CP5 &lt;dbl&gt;, CP1 &lt;dbl&gt;, CP2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   CP6 &lt;dbl&gt;, P7 &lt;dbl&gt;, P3 &lt;dbl&gt;, Pz &lt;dbl&gt;, P4 &lt;dbl&gt;, P8 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   POz &lt;dbl&gt;, O1 &lt;dbl&gt;, Oz &lt;dbl&gt;, O2 &lt;dbl&gt;, EOGV &lt;dbl&gt;, EOGH &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $events</span>
<span class="co">#&gt; # A tibble: 4,276 x 6</span>
<span class="co">#&gt;      .id type         description .sample_0 .size .channel</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;int&gt; &lt;int&gt; &lt;chr&gt;   </span>
<span class="co">#&gt;  1     1 New Segment  &lt;NA&gt;                1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  2     1 Bad Interval Bad Min-Max      2158   738 Fp1     </span>
<span class="co">#&gt;  3     1 Bad Interval Bad Min-Max      2161   731 Fp2     </span>
<span class="co">#&gt;  4     1 Bad Interval Bad Min-Max      2162   729 Fpz     </span>
<span class="co">#&gt;  5     1 Bad Interval Bad Min-Max      2173   689 F8      </span>
<span class="co">#&gt;  6     1 Bad Interval Bad Min-Max      2181   675 F4      </span>
<span class="co">#&gt;  7     1 Bad Interval Bad Min-Max      2182   676 Fz      </span>
<span class="co">#&gt;  8     1 Bad Interval Bad Min-Max      2306   549 F3      </span>
<span class="co">#&gt;  9     1 Bad Interval Bad Min-Max      2899   397 Fp1     </span>
<span class="co">#&gt; 10     1 Bad Interval Bad Min-Max      2901   392 Fpz     </span>
<span class="co">#&gt; # ... with 4,266 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $segments</span>
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;     .id recording  segment</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1     1 faces.vhdr       1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "eeg_lst"</span></code></pre></div>
<p>It provides a summary:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(faces)
<span class="co">#&gt; # EEG data (eeg_lst) from the following channels:</span>
<span class="co">#&gt; # A tibble: 34 x 11</span>
<span class="co">#&gt;    type  .name .reference resolution unit  radius theta   phi    .x    .y</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Ch1   Fp1   avim12     ""         µV         1   -90   -72 -0.31  0.95</span>
<span class="co">#&gt;  2 Ch2   Fpz   avim12     ""         µV         1    90    90  0     1   </span>
<span class="co">#&gt;  3 Ch3   Fp2   avim12     ""         µV         1    90    72  0.31  0.95</span>
<span class="co">#&gt;  4 Ch4   F7    avim12     ""         µV         1   -90   -36 -0.81  0.59</span>
<span class="co">#&gt;  5 Ch5   F3    avim12     ""         µV         1   -60   -51 -0.55  0.67</span>
<span class="co">#&gt;  6 Ch6   Fz    avim12     ""         µV         1    45    90  0     0.71</span>
<span class="co">#&gt;  7 Ch7   F4    avim12     ""         µV         1    60    51  0.55  0.67</span>
<span class="co">#&gt;  8 Ch8   F8    avim12     ""         µV         1    90    36  0.81  0.59</span>
<span class="co">#&gt;  9 Ch9   FC5   avim12     ""         µV         1   -69   -21 -0.87  0.33</span>
<span class="co">#&gt; 10 Ch10  FC1   avim12     ""         µV         1   -31   -46 -0.36  0.37</span>
<span class="co">#&gt; # ... with 24 more rows, and 1 more variable: .z &lt;dbl&gt;</span>
<span class="co">#&gt; # Sampling rate: 500 Hz.</span>
<span class="co">#&gt; # Size in memory: 147 MB.</span>
<span class="co">#&gt; # Summary of segments</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   recording  segment_n</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt;</span>
<span class="co">#&gt; 1 faces.vhdr         1</span>
<span class="co">#&gt; # Summary of events</span>
<span class="co">#&gt; # A tibble: 13 x 3</span>
<span class="co">#&gt; # Groups:   type, description [13]</span>
<span class="co">#&gt;    type         description     n</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;       &lt;int&gt;</span>
<span class="co">#&gt;  1 Bad Interval Bad Min-Max  3734</span>
<span class="co">#&gt;  2 Bad Interval Multiple      105</span>
<span class="co">#&gt;  3 New Segment  &lt;NA&gt;            1</span>
<span class="co">#&gt;  4 Stimulus     s101            1</span>
<span class="co">#&gt;  5 Stimulus     s102            1</span>
<span class="co">#&gt;  6 Stimulus     s111            1</span>
<span class="co">#&gt;  7 Stimulus     s121            1</span>
<span class="co">#&gt;  8 Stimulus     s122            1</span>
<span class="co">#&gt;  9 Stimulus     s130          200</span>
<span class="co">#&gt; 10 Stimulus     s5              1</span>
<span class="co">#&gt; 11 Stimulus     s70           100</span>
<span class="co">#&gt; 12 Stimulus     s71           100</span>
<span class="co">#&gt; 13 UserDefined  Blink          30</span></code></pre></div>
<p>Furthermore, it allows for quick visualization.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(faces)
<span class="co">#&gt; # Downsampling from 500Hz to 2.08333333333333Hz.</span>
<span class="co">#&gt; # Object size in memory 820 kB</span></code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<p>The standard plots can be slightly customized using <code>ggplot</code> layers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(faces) <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">500</span>,<span class="dv">500</span>))
<span class="co">#&gt; # Downsampling from 500Hz to 2.08333333333333Hz.</span>
<span class="co">#&gt; # Object size in memory 820 kB</span></code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>Some intervals were marked as “bad” by BrainVision, and so we’ll remove them from the data. We’ll also segment and baseline the data. In this experiment, the trigger “s70” was used for faces and “s71” for no faces. We’ll segment the data using these two triggers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces_segs &lt;-<span class="st"> </span>faces <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">               </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/segment">segment</a></span>(description <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"s70"</span>, <span class="st">"s71"</span>), 
                        <span class="dt">lim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">2</span>,.<span class="dv">25</span>)) <span class="op">%&gt;%</span>
<span class="st">               </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/event_to_ch_NA">event_to_ch_NA</a></span>(type <span class="op">==</span><span class="st"> "Bad Interval"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">               </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/ch_baseline">ch_baseline</a></span>()
<span class="co">#&gt; # Total of 200 segments found.</span>
<span class="co">#&gt; # Object size in memory 12.7 MB after segmentation.</span></code></pre></div>
<p>We can also edit the segmentation information and add more descriptive labels. <em>eeguana</em> has wrappers for many <code>dplyr</code> commands for the EEG data. These commands always return an entire <code>eeg_lst</code> object so that they can be piped using <code>magrittr</code>’s pipe, <code>%&gt;%</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces_segs_some &lt;-<span class="st"> </span>faces_segs <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">                  </span><span class="kw">mutate</span>(<span class="dt">condition =</span>
                  <span class="kw">if_else</span>(description <span class="op">==</span><span class="st"> "s70"</span>, <span class="st">"faces"</span>, <span class="st">"non-faces"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">select</span>(<span class="op">-</span>type)

faces_segs_some
<span class="co">#&gt; $signal</span>
<span class="co">#&gt; # A tibble: 45,200 x 36</span>
<span class="co">#&gt; # Groups:   .id [200]</span>
<span class="co">#&gt;      .id .sample_id    Fp1   Fpz   Fp2     F7    F3    Fz    F4     F8</span>
<span class="co">#&gt;  * &lt;int&gt;      &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1        -99  3.00  3.82   1.68  5.35   8.53  4.73 3.19  -0.109</span>
<span class="co">#&gt;  2     1        -98  4.65  5.97   2.90  6.23  12.0   6.16 3.99  -0.876</span>
<span class="co">#&gt;  3     1        -97  5.64  7.73   3.36  6.15  12.6   7.13 4.27  -2.20 </span>
<span class="co">#&gt;  4     1        -96  4.89  7.09   1.56  4.68  10.2   6.34 3.26  -3.93 </span>
<span class="co">#&gt;  5     1        -95  1.68  3.59  -2.12  1.82   6.47  4.63 1.39  -5.12 </span>
<span class="co">#&gt;  6     1        -94 -1.11  0.194 -4.62 -1.04   4.09  3.79 0.175 -4.62 </span>
<span class="co">#&gt;  7     1        -93  0.935 0.837 -2.97 -1.40   4.63  4.44 0.815 -2.31 </span>
<span class="co">#&gt;  8     1        -92  5.51  4.36   1.25  0.303  7.07  5.85 2.76   0.464</span>
<span class="co">#&gt;  9     1        -91  7.31  6.30   4.20  1.38   8.46  7.05 4.70   2.63 </span>
<span class="co">#&gt; 10     1        -90  6.71  5.89   5.12  1.61   7.65  7.56 5.98   4.03 </span>
<span class="co">#&gt; # ... with 45,190 more rows, and 26 more variables: FC5 &lt;dbl&gt;, FC1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   FC2 &lt;dbl&gt;, FC6 &lt;dbl&gt;, M1 &lt;dbl&gt;, T7 &lt;dbl&gt;, C3 &lt;dbl&gt;, Cz &lt;dbl&gt;,</span>
<span class="co">#&gt; #   C4 &lt;dbl&gt;, T8 &lt;dbl&gt;, M2 &lt;dbl&gt;, CP5 &lt;dbl&gt;, CP1 &lt;dbl&gt;, CP2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   CP6 &lt;dbl&gt;, P7 &lt;dbl&gt;, P3 &lt;dbl&gt;, Pz &lt;dbl&gt;, P4 &lt;dbl&gt;, P8 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   POz &lt;dbl&gt;, O1 &lt;dbl&gt;, Oz &lt;dbl&gt;, O2 &lt;dbl&gt;, EOGV &lt;dbl&gt;, EOGH &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $events</span>
<span class="co">#&gt; # A tibble: 200 x 6</span>
<span class="co">#&gt;      .id type     description .sample_0 .size .channel</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;int&gt; &lt;int&gt; &lt;chr&gt;   </span>
<span class="co">#&gt;  1     1 Stimulus s70                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  2     2 Stimulus s71                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  3     3 Stimulus s71                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  4     4 Stimulus s71                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  5     5 Stimulus s70                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  6     6 Stimulus s71                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  7     7 Stimulus s71                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  8     8 Stimulus s70                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt;  9     9 Stimulus s70                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt; 10    10 Stimulus s70                 1     1 &lt;NA&gt;    </span>
<span class="co">#&gt; # ... with 190 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $segments</span>
<span class="co">#&gt; # A tibble: 200 x 5</span>
<span class="co">#&gt; # Groups:   .id [200]</span>
<span class="co">#&gt;      .id recording  segment description condition</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;    </span>
<span class="co">#&gt;  1     1 faces.vhdr       1 s70         faces    </span>
<span class="co">#&gt;  2     2 faces.vhdr       2 s71         non-faces</span>
<span class="co">#&gt;  3     3 faces.vhdr       3 s71         non-faces</span>
<span class="co">#&gt;  4     4 faces.vhdr       4 s71         non-faces</span>
<span class="co">#&gt;  5     5 faces.vhdr       5 s70         faces    </span>
<span class="co">#&gt;  6     6 faces.vhdr       6 s71         non-faces</span>
<span class="co">#&gt;  7     7 faces.vhdr       7 s71         non-faces</span>
<span class="co">#&gt;  8     8 faces.vhdr       8 s70         faces    </span>
<span class="co">#&gt;  9     9 faces.vhdr       9 s70         faces    </span>
<span class="co">#&gt; 10    10 faces.vhdr      10 s70         faces    </span>
<span class="co">#&gt; # ... with 190 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "eeg_lst"</span></code></pre></div>
<p>With some “regular” <code>ggplot</code> skills, we can create customized plots. <code>plot_gg</code> downsamples the signals (by default), and converts them to a long-format data frame that is feed into <code>ggplot</code> object. This object can then be customized.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces_segs_some <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">select</span>(O1, O2, P7, P8) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/plot_gg">plot_gg</a></span>(faces_segs_some) <span class="op">+</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> .<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">group =</span> .id, <span class="dt">color =</span> condition)) <span class="op">+</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">stat_summary</span>(<span class="dt">fun.y =</span> <span class="st">"mean"</span>, <span class="dt">geom =</span><span class="st">"line"</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, 
                  <span class="kw">aes</span>(<span class="dt">color =</span> condition)) <span class="op">+</span>
<span class="st">                  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>channel) <span class="op">+</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="st">"dashed"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> .<span class="dv">17</span>, <span class="dt">linetype =</span> <span class="st">"dotted"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) </code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<p>The motivation for manipulating the data in the <code>eeg_lst</code> format and not transforming them directly to a data frame has to do with size considerations. In this case, the original file was 149 MB, converting it to a long format entails a lot of repetition and generates an object of 786 MB. While this is still ok here, a long format quickly becomes prohibitive in real settings with longer recordings and with several subjects.</p>
<p>We can see here the N170 component in the faces condition for the average trial on a single participant. We can investigate the signal by averaging the channels of the occipital and parietal lobes using the capabilities inherited from <code>dplyr</code>, and the special function, <code>chs_mean</code>, a wrapper for <code>rowMeans</code>, which takes as arguments the relevant channels and whether missing values should be omitted from the calculations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces_segs_some <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>(faces_segs_some) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">transmute</span>(<span class="dt">Occipital =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/chs_mean">chs_mean</a></span>(O1, O2, Oz, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                          <span class="dt">Parietal =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/chs_mean">chs_mean</a></span>(P3, P4, P7,  P8, Pz, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/plot_gg">plot_gg</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> .<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">group =</span> .id, <span class="dt">color =</span> condition)) <span class="op">+</span>
<span class="st">                </span><span class="kw">stat_summary</span>(<span class="dt">fun.y =</span> <span class="st">"mean"</span>, <span class="dt">geom =</span><span class="st">"line"</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, 
                  <span class="kw">aes</span>(<span class="dt">color =</span> condition)) <span class="op">+</span>
<span class="st">                </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>channel) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) </code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<p>Another possibility is to create a topographic plot of the two conditions, by first making segments that include only the interval .1-.2 <em>s</em> after the onset of the stimuli.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces_segs_some <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw">filter</span>(<span class="kw">between</span>(.sample_id,<span class="dv">20</span>,<span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                    </span><span class="kw">group_by</span>(condition) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/plot_topo">plot_topo</a></span>()</code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<p>For more specialized plots or analyses, it might be necessary to extract the data in long data frame format first. For example, here, we visualize independent t-tests (or some other statistics) at every electrode and time point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>faces_segs_some <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">select</span>(O1, O2, P7, P8) <span class="op">%&gt;%</span>
<span class="st">      </span>as_tibble <span class="op">%&gt;%</span>
<span class="st">        </span><span class="co"># We can use regular dplyr functions now</span>
<span class="st">      </span><span class="kw">group_by</span>(channel, time) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarize</span>(
        <span class="st">`</span><span class="dt">t-value</span><span class="st">`</span> =<span class="st"> </span><span class="kw">t.test</span>(amplitude[condition <span class="op">==</span><span class="st"> "faces"</span>],
          amplitude[condition <span class="op">==</span><span class="st"> "non-faces"</span>])<span class="op">$</span>statistic)

df
<span class="co">#&gt; # A tibble: 904 x 3</span>
<span class="co">#&gt; # Groups:   channel [?]</span>
<span class="co">#&gt;    channel   time `t-value`</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 O1      -0.2        1.77</span>
<span class="co">#&gt;  2 O1      -0.198      1.56</span>
<span class="co">#&gt;  3 O1      -0.196      1.59</span>
<span class="co">#&gt;  4 O1      -0.194      1.65</span>
<span class="co">#&gt;  5 O1      -0.192      1.62</span>
<span class="co">#&gt;  6 O1      -0.19       1.49</span>
<span class="co">#&gt;  7 O1      -0.188      1.28</span>
<span class="co">#&gt;  8 O1      -0.186      1.12</span>
<span class="co">#&gt;  9 O1      -0.184      1.10</span>
<span class="co">#&gt; 10 O1      -0.182      1.20</span>
<span class="co">#&gt; # ... with 894 more rows</span></code></pre></div>
<p>Then we just load the data frame into <code>ggplot</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> <span class="st">`</span><span class="dt">t-value</span><span class="st">`</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">                </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>channel) </code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
<p>However, this can be also done in the without transforming the <code>eeg_lst</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faces_segs_some_t &lt;-<span class="st"> </span>
<span class="st">  </span>faces_segs_some <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">select</span>(O1, O2, P7, P8) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">group_by</span>(.sample_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(<span class="dt">t =</span> <span class="kw">t.test</span>(.[condition <span class="op">==</span><span class="st"> "faces"</span>],
          .[condition <span class="op">==</span><span class="st"> "non-faces"</span>])<span class="op">$</span>statistic))

  <span class="kw"><a href="http://www.rdocumentation.org/packages/eeguana/topics/plot_gg">plot_gg</a></span>(faces_segs_some_t) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> .<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">group =</span> .id)) <span class="op">+</span>
<span class="st">                </span><span class="kw">stat_summary</span>(<span class="dt">fun.y =</span> <span class="st">"mean"</span>, <span class="dt">geom =</span><span class="st">"line"</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">                </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>channel) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) </code></pre></div>
<p><img src="brainvision_files_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bruno Nicenboim.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
